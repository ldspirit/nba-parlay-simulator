<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Parlay Simulator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        .container { max-width: 900px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 25px; }
        h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #ff6b35, #f7931e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle { color: #888; font-size: 0.9rem; margin-top: 5px; }

        /* Credits Bar */
        .credits-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 20px;
            font-size: 0.8rem;
            color: #888;
            flex-wrap: wrap;
        }
        .credits-bar strong { color: #ff6b35; }
        .credits-bar .good strong { color: #4ade80; }
        .credits-bar .warning strong { color: #fbbf24; }
        .credits-bar .danger strong { color: #f87171; }

        /* Today Section */
        .today-header {
            text-align: center;
            margin-bottom: 20px;
        }
        .today-date {
            font-size: 1.3rem;
            color: #ff6b35;
            font-weight: 600;
        }
        .games-count {
            font-size: 0.85rem;
            color: #888;
            margin-top: 5px;
        }

        /* Game Cards */
        .games-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .game-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }
        .game-card.completed { border-left: 3px solid #4ade80; }
        .game-card.live { border-left: 3px solid #ff6b35; }
        .game-card.upcoming { border-left: 3px solid #2196f3; }

        .game-time {
            min-width: 70px;
            text-align: center;
        }
        .game-time-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: #fff;
        }
        .game-status {
            font-size: 0.7rem;
            text-transform: uppercase;
            margin-top: 3px;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .game-status.upcoming { background: rgba(33, 150, 243, 0.2); color: #2196f3; }
        .game-status.live { background: rgba(255, 107, 53, 0.2); color: #ff6b35; }
        .game-status.final { background: rgba(74, 222, 128, 0.2); color: #4ade80; }

        .matchup {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        .team {
            text-align: center;
            min-width: 100px;
        }
        .team-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .team-name.winner { color: #4ade80; }
        .team-name.loser { color: #666; }

        /* American Odds - Big Display */
        .odds {
            font-size: 1.4rem;
            font-weight: bold;
        }
        .odds.favorite { color: #f87171; }
        .odds.underdog { color: #4ade80; }
        .odds.even { color: #f7931e; }

        .team-score {
            font-size: 1.3rem;
            font-weight: bold;
            color: #fff;
            margin-top: 4px;
        }

        .vs {
            color: #555;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* Parlay Summary */
        .parlay-card {
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.1), rgba(255, 107, 53, 0.1));
            border: 2px solid #4ade80;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }
        .parlay-title {
            font-size: 0.9rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        .parlay-odds {
            font-size: 2rem;
            font-weight: bold;
            color: #4ade80;
        }
        .parlay-details {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #aaa;
        }
        .parlay-details strong { color: #fff; }

        /* No Games */
        .no-games {
            text-align: center;
            padding: 50px 20px;
            color: #888;
        }
        .no-games-icon { font-size: 3rem; margin-bottom: 15px; }

        .loading { text-align: center; padding: 50px; color: #888; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>NBA Parlay Simulator</h1>
            <p class="subtitle">Moneyline Odds - Forward Testing</p>
        </header>
        <div id="content"><div class="loading">Loading...</div></div>
    </div>

    <script>
        const STAKE = 0.10;
        const TEAM_ABBREV = {
            'Atlanta Hawks': 'ATL', 'Boston Celtics': 'BOS', 'Brooklyn Nets': 'BKN',
            'Charlotte Hornets': 'CHA', 'Chicago Bulls': 'CHI', 'Cleveland Cavaliers': 'CLE',
            'Dallas Mavericks': 'DAL', 'Denver Nuggets': 'DEN', 'Detroit Pistons': 'DET',
            'Golden State Warriors': 'GSW', 'Houston Rockets': 'HOU', 'Indiana Pacers': 'IND',
            'Los Angeles Clippers': 'LAC', 'Los Angeles Lakers': 'LAL', 'LA Clippers': 'LAC',
            'LA Lakers': 'LAL', 'Memphis Grizzlies': 'MEM', 'Miami Heat': 'MIA',
            'Milwaukee Bucks': 'MIL', 'Minnesota Timberwolves': 'MIN', 'New Orleans Pelicans': 'NOP',
            'New York Knicks': 'NYK', 'Oklahoma City Thunder': 'OKC', 'Orlando Magic': 'ORL',
            'Philadelphia 76ers': 'PHI', 'Phoenix Suns': 'PHX', 'Portland Trail Blazers': 'POR',
            'Sacramento Kings': 'SAC', 'San Antonio Spurs': 'SAS', 'Toronto Raptors': 'TOR',
            'Utah Jazz': 'UTA', 'Washington Wizards': 'WAS'
        };

        function abbrev(name) { return TEAM_ABBREV[name] || name; }

        function toAmerican(decimal) {
            if (!decimal || decimal <= 1) return '‚Äî';
            if (decimal >= 2) {
                return '+' + Math.round((decimal - 1) * 100);
            } else {
                return Math.round(-100 / (decimal - 1));
            }
        }

        function getOddsClass(decimal) {
            if (!decimal) return '';
            if (decimal > 2.1) return 'underdog';
            if (decimal < 1.9) return 'favorite';
            return 'even';
        }

        function getTodayKey() {
            return new Date().toISOString().split('T')[0];
        }

        async function loadData() {
            try {
                const res = await fetch('data.json?' + Date.now());
                const data = await res.json();
                render(data);
            } catch (e) {
                document.getElementById('content').innerHTML =
                    `<div class="loading">Error: ${e.message}</div>`;
            }
        }

        function render(data) {
            const { games, dailyParlays, lastUpdate, creditsRemaining, creditsUsed } = data;
            const today = getTodayKey();

            // Credits bar
            const creditsClass = creditsRemaining > 300 ? 'good' : creditsRemaining > 100 ? 'warning' : 'danger';

            let html = `
                <div class="credits-bar">
                    <span class="${creditsClass}">Credits: <strong>${creditsRemaining || '?'}/500</strong></span>
                    <span>Used: <strong>${creditsUsed || 0}</strong></span>
                    <span>Source: <strong>DraftKings</strong></span>
                    <span>Updated: <strong>${lastUpdate ? new Date(lastUpdate).toLocaleTimeString() : '‚Äî'}</strong></span>
                </div>
            `;

            // Get today's games
            const todayGames = Object.values(games)
                .filter(g => g.dateKey === today)
                .sort((a, b) => new Date(a.startTime) - new Date(b.startTime));

            const todayParlay = dailyParlays[today];
            const dateDisplay = new Date().toLocaleDateString('en-US', {
                weekday: 'long', month: 'long', day: 'numeric'
            });

            html += `
                <div class="today-header">
                    <div class="today-date">${dateDisplay}</div>
                    <div class="games-count">${todayGames.length} Game${todayGames.length !== 1 ? 's' : ''} Today</div>
                </div>
            `;

            if (todayGames.length === 0) {
                html += `
                    <div class="no-games">
                        <div class="no-games-icon">üèÄ</div>
                        <div>No NBA games scheduled for today</div>
                        <div style="margin-top: 10px; font-size: 0.85rem">Check back later for upcoming games</div>
                    </div>
                `;
            } else {
                html += `<div class="games-grid">`;

                todayGames.forEach(g => {
                    const now = new Date();
                    const gameTime = new Date(g.startTime);
                    const isCompleted = g.completed;
                    const isLive = !isCompleted && gameTime <= now;

                    const cardClass = isCompleted ? 'completed' : (isLive ? 'live' : 'upcoming');
                    const statusClass = isCompleted ? 'final' : (isLive ? 'live' : 'upcoming');
                    const statusText = isCompleted ? 'Final' : (isLive ? 'Live' : 'Upcoming');

                    const awayClass = isCompleted ? (g.winner === g.awayTeam ? 'winner' : 'loser') : '';
                    const homeClass = isCompleted ? (g.winner === g.homeTeam ? 'winner' : 'loser') : '';

                    const timeStr = gameTime.toLocaleTimeString('en-US', {
                        hour: 'numeric',
                        minute: '2-digit'
                    });

                    html += `
                        <div class="game-card ${cardClass}">
                            <div class="game-time">
                                <div class="game-time-value">${timeStr}</div>
                                <div class="game-status ${statusClass}">${statusText}</div>
                            </div>
                            <div class="matchup">
                                <div class="team">
                                    <div class="team-name ${awayClass}">${abbrev(g.awayTeam)}</div>
                                    <div class="odds ${getOddsClass(g.awayOdds)}">${toAmerican(g.awayOdds)}</div>
                                    ${isCompleted ? `<div class="team-score">${g.awayScore}</div>` : ''}
                                </div>
                                <div class="vs">@</div>
                                <div class="team">
                                    <div class="team-name ${homeClass}">${abbrev(g.homeTeam)}</div>
                                    <div class="odds ${getOddsClass(g.homeOdds)}">${toAmerican(g.homeOdds)}</div>
                                    ${isCompleted ? `<div class="team-score">${g.homeScore}</div>` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += `</div>`;

                // Parlay summary
                if (todayParlay) {
                    const parlayAmerican = todayParlay.totalOdds ? toAmerican(todayParlay.totalOdds) : '‚Äî';
                    html += `
                        <div class="parlay-card">
                            <div class="parlay-title">Today's Parlay (All Winners)</div>
                            <div class="parlay-odds">${parlayAmerican}</div>
                            <div class="parlay-details">
                                <span>Stake: <strong>$${STAKE.toFixed(2)}</strong></span>
                                <span>Payout: <strong>${todayParlay.payout ? '$' + todayParlay.payout.toFixed(2) : '‚Äî'}</strong></span>
                                <span>Progress: <strong>${todayParlay.completedGames}/${todayParlay.totalGames}</strong></span>
                            </div>
                        </div>
                    `;
                }
            }

            document.getElementById('content').innerHTML = html;
        }

        loadData();
        setInterval(loadData, 60000);
    </script>
</body>
</html>
